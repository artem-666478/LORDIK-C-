using System;
using System.Data;
using Microsoft.Data.SqlClient;

string connectionString = "Data Source=(localdb)\\mssqllocaldb;Initial Catalog=DeliveryDB;Integrated Security=True";
SqlConnection connection = new SqlConnection(connectionString);

try
{
    connection.Open();
    Console.WriteLine("Подключение успешно");

    string createTables = @"
        CREATE TABLE Клиенты (
            ID_клиента INT PRIMARY KEY IDENTITY(1,1),
            Телефон_клиента NVARCHAR(20) NOT NULL,
            Почта_клиента NVARCHAR(100) NOT NULL
        );

        CREATE TABLE Курьеры (
            ID_курьера INT PRIMARY KEY IDENTITY(1,1),
            Телефон_курьера NVARCHAR(20) NOT NULL,
            Город_курьера NVARCHAR(50) NOT NULL
        );

        CREATE TABLE Ресторан (
            ID_ресторана INT PRIMARY KEY IDENTITY(1,1),
            Название_ресторана NVARCHAR(100) NOT NULL,
            Тип_ресторана NVARCHAR(50) NOT NULL,
            Город_ресторана NVARCHAR(50) NOT NULL
        );

        CREATE TABLE Заказы (
            ID_заказа INT PRIMARY KEY IDENTITY(1,1),
            Сумма_заказа DECIMAL(10,2) NOT NULL,
            ID_клиента INT NOT NULL,
            ID_ресторана INT NOT NULL,
            ID_курьера INT NOT NULL,
            Город_заказа NVARCHAR(50) NOT NULL,
            FOREIGN KEY (ID_клиента) REFERENCES Клиенты(ID_клиента),
            FOREIGN KEY (ID_ресторана) REFERENCES Ресторан(ID_ресторана),
            FOREIGN KEY (ID_курьера) REFERENCES Курьеры(ID_курьера)
        );";

    SqlCommand createCommand = new SqlCommand(createTables, connection);
    createCommand.ExecuteNonQuery();
    Console.WriteLine("Таблицы созданы");

    string insertClients = @"
        INSERT INTO Клиенты (Телефон_клиента, Почта_клиента) VALUES
        ('+79161112233', 'ivanov@mail.ru'),
        ('+79262223344', 'petrova@gmail.com'),
        ('+79363334455', 'sidorov@yandex.ru'),
        ('+79464445566', 'smirnova@mail.ru'),
        ('+79565556677', 'kozlov@gmail.com')";

    SqlCommand clientsCommand = new SqlCommand(insertClients, connection);
    clientsCommand.ExecuteNonQuery();

    string insertCouriers = @"
        INSERT INTO Курьеры (Телефон_курьера, Город_курьера) VALUES
        ('+79666667788', 'Москва'),
        ('+79767778899', 'Санкт-Петербург'),
        ('+79868889900', 'Москва'),
        ('+79969990011', 'Новосибирск'),
        ('+79060001122', 'Екатеринбург')";

    SqlCommand couriersCommand = new SqlCommand(insertCouriers, connection);
    couriersCommand.ExecuteNonQuery();

    string insertRestaurants = @"
        INSERT INTO Ресторан (Название_ресторана, Тип_ресторана, Город_ресторана) VALUES
        ('Суши Вок', 'Японский', 'Москва'),
        ('Паста Бар', 'Итальянский', 'Санкт-Петербург'),
        ('Бургер Кинг', 'Фастфуд', 'Москва'),
        ('Печки-Лавочки', 'Русский', 'Новосибирск'),
        ('Тако Белл', 'Мексиканский', 'Екатеринбург')";

    SqlCommand restaurantsCommand = new SqlCommand(insertRestaurants, connection);
    restaurantsCommand.ExecuteNonQuery();

    string insertOrders = @"
        INSERT INTO Заказы (Сумма_заказа, ID_клиента, ID_ресторана, ID_курьера, Город_заказа) VALUES
        (1250.50, 1, 1, 1, 'Москва'),
        (890.00, 2, 2, 2, 'Санкт-Петербург'),
        (1560.75, 3, 3, 3, 'Москва'),
        (2100.00, 4, 4, 4, 'Новосибирск'),
        (750.25, 5, 5, 5, 'Екатеринбург'),
        (1340.80, 1, 3, 1, 'Москва'),
        (980.60, 2, 1, 2, 'Санкт-Петербург')";

    SqlCommand ordersCommand = new SqlCommand(insertOrders, connection);
    ordersCommand.ExecuteNonQuery();

    Console.WriteLine("Данные добавлены");

    bool flag = true;
    while (flag)
    {
        Console.WriteLine(@"Что вы хотите сделать?:
1) Показать Клиентов
2) Показать Курьеров
3) Показать Рестораны
4) Показать Заказы
5) ВЫХОД
");
        int choice = Convert.ToInt16(Console.ReadLine());
        
        switch (choice)
        {
            case 1:
                ShowTable("Клиенты", connection);
                break;
            case 2:
                ShowTable("Курьеры", connection);
                break;
            case 3:
                ShowTable("Ресторан", connection);
                break;
            case 4:
                ShowTable("Заказы", connection);
                break;
            case 5:
                flag = false;
                break;
        }
    }
}
catch(Exception ex)
{
    Console.WriteLine(ex.ToString());
}
finally
{
    connection.Close();
    Console.WriteLine("БД закрыта");
}

void ShowTable(string tableName, SqlConnection conn)
{
    string sql = $"SELECT * FROM {tableName}";
    SqlCommand command = new SqlCommand(sql, conn);
    SqlDataReader reader = command.ExecuteReader();
    
    Console.WriteLine($"\n=== {tableName.ToUpper()} ===");

    for (int i = 0; i < reader.FieldCount; i++)
    {
        Console.Write($"{reader.GetName(i)}\t");
    }
    Console.WriteLine();

    while (reader.Read())
    {
        for (int i = 0; i < reader.FieldCount; i++)
        {
            Console.Write($"{reader[i]}\t");
        }
        Console.WriteLine();
    }
    
    reader.Close();
}
